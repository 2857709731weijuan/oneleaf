<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/shopping.css">
</head>
<body>
    <div class="headerbox">
        <!-- header -->
        <header>
            <div class="hleft">
                <a href="#"> <img src="img/icon_wb.png" alt="" class="wb"></a>
                <a href="#"> <img src="img/icon_wx.png" alt="" class="wx">
                    <img src="img/wx2img.jpg" alt="" class="wximg">
                </a>
            </div>
            <div class="hmiddle">
                <a href="index.html"><img src="img/logo.png" alt=""></a>
            </div>
            <div class="hright">
                <a href="page3.html"> 注册登录</a>
                <a href=""> 联系我们</a>
            </div>
        </header>
        <!-- nav -->
        <nav id="navv">
            <div class="navbox">
                <a href="mianmo.html">面膜</a>
                <img src="img/icon_round.png" alt="">
                <a href="page1.html">护肤</a>
                <img src="img/icon_round.png" alt="">
                <a href="page2.html" class="pin lis ">专属产品</a>
                <img src="img/icon_round.png" alt="">
                <a href="page6.html" class="lis">品牌专卖店</a>
                <img src="img/icon_round.png" alt="">
                <a href="page5.html">新品试用</a>
            </div>
            <form class="navbar-form navbar-left" role="search">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="搜素...">
                </div>
                <button type="submit" class="btn btn-default">搜素</button>
            </form>
            <div id="small">
                <div class="pinbox boxmegg" id="C">
                    <a href="page2.html">专属产品</a>
                    <a href="#">明星产品</a>
                </div>
                <div class="dianbox boxmegg" id="E">
                    <a href="#">品牌故事</a>
                    <a href="#">品牌资讯</a>
                    <a href="#">当季促销</a>
                    <a href="#">会员专区</a>
                    <a href="#">门店信息</a>
                    <a href="#">加盟政策</a>
                    <a href="#">财富分享</a>
                </div>
            </div>
        </nav>
    </div>
<!-- content -->
<div class="content">
    <div class="image">
        <img src="img/listcover.jpg" alt="">
    </div>
    <div id="cart">
        <div id="cart-header">
            <!-- <div class="left w110 ml10"> -->
            <div class=" w110">
                <input id="selectAll" type="checkbox">
                <label for="selectAll">全选</label>
            </div>
            <div class="w250">商品</div>
            <div class=" w120 ">单价</div>
            <div class=" w120">数量</div>
            <div class=" w120">小计</div>
            <div class="w120">操作</div>
        </div>
        <div id="cart-items">
            <!-- <div class="single-item">
                <div class=" w20 ">
                    <input name="selectOne" type="checkbox">
                </div>
                <div class=" w90">
                    <a href="">
                        <img src="imgs/showImg (5).jpg">
                    </a>
                </div>
                <div class=" w250">
                    <span>
                        Jojoba Moisturizing Cleanser <br>一叶子霍霍巴倍润滋养 <br>洁面乳
                    </span>
                </div>
                <div class=" w130 ">&yen;<span class="price">138.00</span></div>
                <div class=" w130 ">
                    <button class="small-button" >-</button>
                    <input class="center count" type="text" size="2" value="1">
                    <button class="small-button">+</button>
                </div>
                <div class="w130 ">&yen;<span>138.00</span></div>
                <div class=" w130 ">
                    <a href="javascript:void(0);">删除</a>
                </div>
            </div>-->
            <div class="single-item">
                    <div class=" w20 ">
                        <input name="selectOne" type="checkbox">
                    </div>
                    <div class=" w90">
                        <a href="">
                            <img src="imgs/showImg (3).jpg">
                        </a>
                    </div>
                    <div class=" w250">
                        <span>
                            Jojoba Moisturizing Cleanser <br>一叶子霍霍巴倍润滋养 <br>洁面乳
                        </span>
                    </div>
                    <div class=" w130 ">&yen;<span class="price">138.00</span></div>
                    <div class=" w130 ">
                        <button class="small-button" >-</button>
                        <input class="center count" type="text" size="2" value="1">
                        <button class="small-button">+</button>
                    </div>
                    <div class="w130 ">&yen;<span>138.00</span></div>
                    <div class=" w130 ">
                        <a href="javascript:void(0);">删除</a>
                    </div>
                </div>
                <div class="single-item">
                    <div class=" w20 ">
                        <input name="selectOne" type="checkbox">
                    </div>
                    <div class=" w90">
                        <a href="">
                            <img src="imgs/showImg (3).jpg">
                        </a>
                    </div>
                    <div class=" w250">
                        <span>
                            Jojoba Moisturizing Cleanser <br>一叶子霍霍巴倍润滋养 <br>洁面乳
                        </span>
                    </div>
                    <div class=" w130 ">&yen;<span class="price">138.00</span></div>
                    <div class=" w130 ">
                        <button class="small-button" >-</button>
                        <input class="center count" type="text" size="2" value="1">
                        <button class="small-button">+</button>
                    </div>
                    <div class="w130 ">&yen;<span>138.00</span></div>
                    <div class=" w130 ">
                        <a href="javascript:void(0);">删除</a>
                    </div>
                </div> 
                
        </div>
        
    </div>
</div>           
<!-- footer -->
<div class="foot">
    <div id="cart-footer">
        <div class="clear ">
            <a id="clearSelected" href="javascript:void(0);">删除选中商品</a>
        </div>
        <div class="right">
            <span>总共选中了<span id="totalCount">0</span>件商品</span>
            <span>总计: <span id="totalPrice">&yen;0.00</span></span>
            <input class="big-button" type="button" value="去结算">
        </div>
    </div>
    <div class="footer">
        <hr>
        上海上美化妆品有限公司 <a href="#">沪ICP备12043696号-5</a> <br>
        中国·上海市中山北路3300号环球港B座22层 TEL：021-52035555
    </div>
</div>
</body>
</html>
<script src="js/jquery-1.8.3.min.js"></script>
<script src="js/checkbox.js"></script>
<script>
var lis = document.getElementsByClassName("lis");
    var divs = document.getElementsByClassName("boxmegg");
    var divd = document.getElementById("navv");
    var div = document.getElementById("small");
    var lll = div.children;
    for (var i = 0; i < lis.length; i++) {
        lis[i].num = i;
        lis[i].onmouseover = function () {
            for (var j = 0; j < divs.length; j++) {
                divs[j].style.display = "none";
            }
            divs[this.num].style.display = "block";
        }
        divd.onmouseleave = function () {
            for (var s = 0; s < lll.length; s++) {
                lll[s].style.display = "none";
            }
        }
    }
    window.onload= function(){
        let req = new XMLHttpRequest();
		req.open("get","getShoppingCart.php?vipName="+"null",true);
		req.onreadystatechange = function(){
			if(req.readyState==4 && req.status==200){
				let str = req.responseText;
				let objs = JSON.parse(str);
                let htmlStr ="";
                for(let i=0;i<objs.length;i++){
				 htmlStr = `<div class="single-item">
                <div class=" w20 ">
                    <input name="selectOne" type="checkbox">
                </div>
                <div class=" w90">
                    <a href="">
                        <img src="${objs[i].goodsImg}">
                    </a>
                </div>
                <div class=" w250">
                    <span>
                        ${objs[i].goodsType} <br>${objs[i].goodsName} <br>洁面乳
                    </span>
                </div>
                <div class=" w130 ">&yen;<span class="price">${objs[i].goodsPrice}</span></div>
                <div class=" w130 ">
                    <button class="small-button" >-</button>
                    <input class="center count" type="text" size="2" value="1">
                    <button class="small-button">+</button>
                </div>
                <div class="w130 ">&yen;<span>${objs[i].goodsDesc}</span></div>
                <div class=" w130 ">
                    <input type="button" value="删除" onclick="Delect()">
                </div>
            </div>`;  
        }
				$("#cart-items").html(htmlStr);
            }
            $(function() {
                // this到底是什么要看具体的上下文环境
                // 简单的说函数中的this指的是谁调用了这个函数或者谁引发了这个函数的执行
                $('#selectAll').on('change', function(evt) {
                    // 获取事件源的两种方式: evt.target或者this
                    // 这里拿到的是原生的JavaScript对象
                    if ($(this).prop('checked')) {
                        $('.single-item input[type="checkbox"]').prop('checked', true);
                        calcTotal();
                    } else {
                        $('.single-item input[type="checkbox"]').prop('checked', false);
                        $('#totalCount').text('0');
                        $('#totalPrice').html('&yen;0.00');
                    }
                });

                // 为单个商品项的复选框绑定改变事件
                $('input[name="selectOne"]').on('change', function() {
                    calcTotal();
                    if (!$(this).prop('checked')) {
                        $('#selectAll').prop('checked', false);
                    }
                });

                // 为删除选中商品超链接绑定事件回调
                $('#clearSelected').on('click', function() {
                    if (window.confirm('确定要删除所选商品吗?')) {
                        $('.single-item').each(function() {
                            if ($(this).find('input[name="selectOne"]').prop('checked')) {
                                $(this).remove();
                            }
                        });
                        calcTotal();
                    }
                });

                // 为减少和添加商品数量的按钮绑定事件回调
                $('.single-item button').on('click', function(evt) {
                    $(this).parent().parent().find('input[name="selectOne"]').prop('checked', true);
                    if ($(this).text() == '-') {
                        var count = parseInt($(this).next().val());
                        if (count > 1) {
                            count -= 1;
                            $(this).next().val(count);
                        } else {
                            alert('商品数量最少为1');
                        }
                    } else {
                        var count = parseInt($(this).prev().val());
                        if (count < 200) {
                            count += 1;
                            $(this).prev().val(count);
                        } else {
                            alert('商品数量最多为200');
                        }
                    }
                    var price = parseFloat($(this).parent().prev().find('span').text());
                    $(this).parent().next().html('&yen;' + (price * count).toFixed(2));
                    calcTotal();
                });

                // 为单个商品项删除超链接绑定事件回调
                $('.single-item a').on('click', function() {
                    if (window.confirm('确定要删除该项吗?')) {
                        $(this).parent().parent().remove();
                        calcTotal();
                    }
                });

                // 为商品数量文本框绑定改变事件回调
                $('.single-item input[type="text"]').on('change', function() {
                    $(this).parent().parent().find('input[name="selectOne"]').prop('checked', true);
                    var count = parseInt($(this).val());

                    if (count != $(this).val() || count < 1 || count > 200) {
                        alert('无效的商品数量值');
                        count = 1;
                        $(this).val(count);
                    }
                    var price = parseFloat($(this).parent().prev().find('span').text());
                    $(this).parent().next().html('&yen;' + (price * count).toFixed(2));
                    calcTotal();
                });

                // 计算总计
                function calcTotal() {
                    var checkBoxes = $('input[name="selectOne"]');
                    var priceSpans = $('.single-item .price');
                    var countInputs = $('.single-item .count');
                    var totalCount = 0;
                    var totalPrice = 0;
                    for (var i = 0; i < priceSpans.length; i += 1) {
                        // 复选框被勾中的购物车项才进行计算
                        if ($(checkBoxes[i]).prop('checked')) {
                            // 强调: jQuery对象使用下标运算或get方法会还原成原生的JavaScript对象
                            var price = parseFloat($(priceSpans[i]).text());
                            var count = parseInt($(countInputs[i]).val());
                            totalCount += count;
                            totalPrice += price * count;
                        }
                    }
                    $('#totalCount').text(totalCount);
                    $('#totalPrice').html('&yen;' + totalPrice.toFixed(2));
                }
            });
        }
        
		req.send();
    }
    function Delect(){
        let xhr = new XMLHttpRequest();
    
    xhr.open("post","deleteGoods.php",true);

    xhr.onreadystatechange = function(){
        if(xhr.readyState==4 && xhr.status==200){
            if(xhr.responseText=="1"){
                alert("删除成功！")
            }else{
               alert("删除失败！")
            }
        }
    }
    //post方式：设置请求头
    xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    //post方式：把传给服务器端数据（键值对）放在send函数的参数里。
    let sendstr = `vipName=${"1839417365"}&goodsId=${"0001"}}`;
    xhr.send(sendstr);
}
     
    
</script>